# Проектная работа "Веб-ларек"
Проект представляет собой интернет-магазин с функционалом.
Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар

```
interface IProduct {
  id: string;
  title: string;
  description: string;
  image: string;
  category: string;
  price: number | null;
}
```

Интерфейс для модального окна способ оплаты

```
interface IPaymentForm {
  payment: string;
  address: string;
}
```

Интерфейс для модального окна контактные данные

```
interface IContactForm {
  email: string;
  phone: string;
}
```

Форма заказа

```
interface IOrder extends IPaymentForm, IContactForm {
  total: number;
  items: string[];
}
```

Корзина

```
interface ICart {
  items: HTMLElement[]; //список товаров в корзине
  total: number; //получившаяся сумма
}
```

Главная страница

```
interface IAppState {
  catalog: IProduct[];
  cart: string[];
  preview: string | null; //предпросмотр
  order: IOrder | null;
  loading: boolean; //загрузка
}
```

Результат оформления заказа

```
interface IOrderResult {
  id: string;
  total: number;
}
```

Ошибка в форме

```
type FormErrors = Partial<Record<keyof IOrderForm, string>>;
```

Данные карточки товара

```
interface ICards extends IProduct {
    index?: string;
    buttonTitle?: string;
}
```

Главная страница

```
interface IPage {
    counter: number; //счетчик
    gallery: HTMLElement[];
}
```

Данные событий

```
interface IActions {
    onClick: (event: MouseEvent) => void; //событие по клику
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечающий за отображение данных на странице;
- слой данных, отвечающий за хранение и изменение данных;
- презентер, отвечающий за связь представдения и данных.

### Базовый код

#### Класс API

Содержит в себе базовую логику отправки запросов. Его функции: получение и отправление данных на сервер.

- Конструктор (constructor) — инициализирует базовый URL (baseUrl) и параметры запроса (options), устанавливая заголовки;

- handleResponse — обрабатывает ответ сервера. Если ответ успешен (response.ok), возвращает распарсенный JSON. Если неуспешен, извлекает и возвращает ошибку из ответа или статус;

- get — выполняет GET-запрос по указанному URI (uri), использует базовый URL, добавляет дополнения и обрабатывает ответ через handleResponse;

- post — выполняет POST-запрос по URI, отправляет переданные данные в формате JSON, также обрабатывает ответ через handleResponse.

#### Класс EventEmitter

Реализует механизм событийного брокера, позволяющий создавать, слушать и управлять событиями в приложении. Вот его основные функции:

- on — добавляет обработчик (слушателя) для определённого события;

- off — удаляет указанный обработчик из списка слушателей для события;

- emit — инициирует событие и передает связанные данные;

- onAll — регистрирует обработчик, который будет вызван при любом событии, независимо от его имени;

- offAll — очищает все зарегистрированные обработчики, сбрасывая коллекцию событий;

- trigger — создаёт функцию-коллбек, которая при вызове вызывает emit, генерируя событие и передавая переданный контекст или объект.

#### Класс Component \<T\>

Абстрактный класс для создания UI-компонентов, который управляет DOM-элементами внутри указанного контейнера (container). Он предоставляет методы для работы с DOM: переключение классов, установка текста, управление состоянием элементов (скрытие, включение/выключение), установка изображений и рендеринг.

Основные функции:

- toggleClass(element: HTMLElement, className: string, force?: boolean) - переключает наличие CSS-класса у элемента;

- setText(element: HTMLElement, value: unknown) - устанавливает текстовое содержимое элемента, преобразуя значение к строке;

- setDisabled(element: HTMLElement, state: boolean) - устанавливает или удаляет атрибут disabled у элемента;

- setHidden(element: HTMLElement) - скрывает элемент, установив свойство display: none;

- setVisible(element: HTMLElement) - делает элемент видимым, убирая свойство display;

- setImage(element: HTMLImageElement, src: string, alt?: string) - устанавливает источник изображения и альтернативный текст у <img> элемента;

- render(data?: Partial<T>) - возвращает основной DOM-элемент компонента (container).

#### Класс Model \<T\>

Базовая абстрактная модель, которая служит для работы с данными и уведомления об их изменениях. Вот основные функции и особенности этого класса:

- Конструктор - принимает частичный набор данных data и объект events, реализующий интерфейс IEvents. Инициализирует свойства модели данными через Object.assign;

- Метод emitChanges - отправляет событие через систему событий (events.emit), уведомляя об изменениях модели. Принимает название события (event) и необязательный объект полезной нагрузки (payload).

### Слой данных

#### Класс AppState

Реализует управление состоянием приложения, связанное с каталогом товаров, корзиной, оформлением заказа и формами. Является наследником Model. Использует интерфейс IAppState.

Основные свойства: 

- basket - корзина покупок;
- catalog - массив товаров, доступных для выбора;
- order - форма заказа с данными клиента;
- preview - предварительный просмотр товара;
- formErrors - ошибки форм;
- currentCard - выбранная карта.

Основные методы:

- refreshBasket() - вызывает обновления, связанные с количеством и содержимым корзины;
- clearBasket() - очищает корзину;
- handleCartAction(action, item): добавляет или удаляет товар из корзины;
- setCatalog(items) - обновляет каталог товаров;
- setPreview(item) - устанавливает текущий товар для предпросмотра;
- setContactForm(field, value) - обновляет контактную информацию (email, телефон);
- setPaymentForm(field, value) - обновляет данные заказа (адрес);
- validateContactForm() - проверяет правильность введенных контактов, обновляет formErrors;
- validatePaymentForm() - проверяет правильность заказа, обновляет formErrors;
- clearOrder() - сбрасывает поля заказа в начальное состояние.

#### Класс Product

Используется для создания, управления и работы с данными продукта. Является наследником Model. Использует интерфейс IProduct.

Основные свойства: 

- id: string — идентификатор продукта;
- description: string — описание товара;
- image: string — изображение продукта;
- title: string — название товара;
- category: string — категория, к которой принадлежит товар;
- price: number | null — цена товара.

### Слой представления

#### Класс Modal

Реализует функциональность всплывающего модального окна. Наследуется от Component. Он позволяет отображать, закрывать и управлять содержимым модалки, а также обрабатывать события открытия и закрытия. Инициализирует поля _closeButton (кнопка закрытия модального окна), _content (контейнер для отображаемого содержимого) с помощью функции ensureElement. Назначает обработчики событий: Клик по кнопке закрытия вызывает метод close. Клик по всему контейнеру также вызывает close. Клик внутри _content останавливает распространение события, чтобы не закрывать модалку при клике внутрь.

Методы: 

- set content(value: HTMLElement) - задаёт содержимое модалки, заменяя его;

- open() - показывает модальное окно, добавляя класс modal_active и эмиттит событие modal:open;

- close() - скрывает модалку, удаляя класс modal_active, очищает содержимое и эмиттит событие modal:close;

- render(data: IModalData) - вызывает родительский метод render, открывает модалку и возвращает контейнер.

#### Класс Form \<T\>

Реализует функциональность формы на веб-странице с возможностью обработки пользовательского ввода, валидации и управления состоянием формы. Наследует класс Component. Инициализирует поля _submit (кнопка отправки формы) и _errors (элемент, где отображаются ошибки формы) через функцию ensureElement. Добавляет слушатели событий: input: при изменении любого поля формы вызывает onInputChange, передавая имя поля и его значение. submit: при попытке отправить форму предотвращает стандартное поведение и вызывает событие формы с помощью this.events.emit.

Методы: 

- onInputChange(field: keyof T, value: string) - при изменении поля формы вызывает событие с именем ${форма_имя}.${имя_поля}:change, передавая имя поля и его значение;

- set valid(value: boolean) - включает или отключает кнопку отправки формы в зависимости от валидности;

- set errors(value: string) - отображает сообщение об ошибке в элементе _errors; 

- render(state: Partial<T> & IFormState) - обновляет состояние формы, вызывая родительский render, устанавливает остальные свойства формы и возвращает сам элемент формы.

#### Класс Basket

Управляет отображением списка товаров в корзине, общей ценой и кнопкой для оформления заказа. Наследуется от Component.

Основные функции:

- Конструктор - инициализирует элементы DOM, привязывает обработчик клика по кнопке для открытия формы заказа через событие 'order:open';
- set items(items) - обновляет список товаров в корзине;
- set total(total) - обновляет отображаемую сумму стоимости товаров.

#### Класс Page

Управляет элементами отображения, такими как счетчик корзины, галерея, а также обеспечивает взаимодействие с пользователем и изменение состояния страницы. Наследуется от Component.

Основные функции:

- Конструктор - находит необходимые элементы DOM по классам, подписывается на клик по корзине, чтобы при его срабатывании инициировать событие открытия корзины;
- handleCartClick - обработчик клика по корзине, вызывает событие для дальнейшей обработки;
- set counter(value) - обновляет отображение количества товаров на странице;
- set gallery(items) - обновляет содержимое галереи.

#### Класс OrderForm

Управляет кнопками выбора способа оплаты, обновлением данных формы. Наследуется от Form.

Основные функции:

- Конструктор - находит кнопки оплаты по их атрибутам name, назначает начальную активную кнопку, добавляет обработчики на обе кнопки;
- addButtonClickHandler(onClick) - вешает один обработчик событий на обе кнопки, что позволяет управлять выбором способа оплаты;
- set address(value) - устанавливает значение поля адреса;
- toggleButton(toggleOn) - переключает активность кнопок.

#### Класс ContactForm

Компонент формы для ввода контактных данных (телефон и email). Наследуется от Form.

Основные функции:

- constructor(container: HTMLFormElement, events: IEvents)Конструктор - получает HTML-элемент формы и объект событий events, передает их в базовый класс Form;
- Геттер phone - возвращает значение поля phone формы, получая его через DOM-элемент с name="phone", использует приведение типа HTMLInputElement, чтобы обратиться к свойству value;
- Сеттер phone - устанавливает значение поля phone через DOM-элемент с name="phone";
- Геттер email - возвращает значение поля email;
- Сеттер email - позволяет задать значение поля email.

#### Класс Card

Карточка товара. Управляет отображением данных, таких как заголовок, цена, изображение, категория и действие по кнопке. Наследуется от Component.

Позволяет управлять содержимым карточки через геттеры и сеттеры:

- id - идентификатор карточки;
- title - название товара;
- price - цена;
- text - текстовое описание;
- image - изображение;
- category - категория товара;

#### Класс ShopApi

Позволяет получать список товаров, отдельный товар по идентификатору и размещать заказы. Этот класс наследует базовые функции API из класса Api и реализует интерфейс IShopApi.

Основные функции:

- constructor(cdn: string, baseUrl: string, options?: RequestInit) Конструктор - инициализирует объект API с базовым URL и опциями запроса, сохраняет cdn — базовый путь для изображений;
- getItemList() - получает список товаров с сервера, проходит по каждому товару и добавляет к полю image полный путь, присоединив cdn, возвращает промис с массивом товаров;
- getItem(id: string) - получает единичный товар по его идентификатору, формирует полный URL для изображения, добавляя cdn, возвращает промис с объектом товара;
- orderItems(order: IOrder) - отправляет заказ на сервер, передает объект заказа, получает и возвращает результат выполнения заказа.

#### Класс Success

Компонент пользовательского интерфейса, отображающий сообщение об успешном завершении операции. Расширяет базовый класс Component и управляет отображением и поведением элементов внутри этого компонента.

Основные функции:

- constructor(container: HTMLElement, actions: ISuccessActions) Конструктор - принимает корневой контейнер элемента, внутри которого расположен компонент, принимает объект actions с коллбэками, внутри конструктора ищет важные DOM-элементы: .order-success__close — элемент, по которому вызывается событие закрытия, .order-success__description — элемент, в который вставляется текст описания, назначает обработчик клика на кнопку закрытия;
- Геттер description - возвращает текущий текст внутри элемента _description;
- Сеттер description - устанавливает текст в _description, добавляя к нему динамический текст.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Список всех событий, которые могут генерироваться в системе:
- `items:change`: обновляет галерею на странице при изменении каталога товаров;
- `modal:open`: блокирует прокрутку страницы при открытии модального окна;
- `modal:close`: разблокирует прокрутку страницы при закрытии модального окна;
- `card:select`: вызывает функцию для изменения просмотра выбранного товара;
- `cart:open`: открывает корзину в модальном окне;
- `product:add`: добавляет товар в корзину;
- `product:delete`: удаляет товар из корзины;
- `cart:changed`: обновляет список товаров в корзине, сумму и состояние кнопки;
- `counter:changed`: обновляет счетчик количества товаров в корзине;
- `contact:open`: открывает контактную форму в модальном окне;
- `order:open`: открывает форму заказа;
- `orderErrors:change`: обновляет состояние и ошибки валидации формы заказа;
- `formErrors:change`: обновляет состояние и ошибки валидации контактной формы;
- `order:ready`: отмечает форму заказа как валидную;
- `contact:ready`: отмечает контактную форму как валидную;
- `contacts:submit`: отправляет данные заказа;
- `order:submit`: инициирует открытие формы контактов для завершения заказа.